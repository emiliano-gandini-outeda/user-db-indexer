import{createApp as A,ref as m,computed as b,onMounted as N}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";import x from"https://unpkg.com/minisearch@7.2.0/dist/es/index.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const u of t.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();A({setup(){const a=m(""),r=m(""),i=m(""),o=m([]),e=m(!0),t=m(!1);let u=null,c=[],y=null;const w=b(()=>a.value.trim()||r.value.trim()||i.value.trim()),L=b(()=>{const s=[];return a.value.trim()&&s.push(`ID: ${a.value}`),r.value.trim()&&s.push(`Nombre: ${r.value}`),i.value.trim()&&s.push(`Apellido: ${i.value}`),s.join(" + ")}),g=m(""),S=async s=>{e.value=!0;try{const l=new URLSearchParams;l.append("q",s),l.append("limit","50000"),c=await(await fetch(`/api/search?${l}`)).json(),u=new x({fields:["nombre","apellido"],storeFields:["id","nombre","apellido"]}),u.addAll(c.map(f=>({...f,id:String(f.id)}))),t.value=!0}catch(l){console.error(l)}finally{e.value=!1}},O=async()=>{const s=a.value.trim()||r.value.trim()||i.value.trim();if(!s){o.value=[],c=[],t.value=!1;return}if((s!==g.value||c.length===0)&&(g.value=s,await S(s)),!t.value)return;const l=30;let d=[];if(a.value.trim()){const p=a.value.trim(),v=c.find(h=>String(h.id)===p);v?d.push({...v}):d=c.filter(n=>String(n.id).startsWith(p)).slice(0,l),o.value=d;return}const f=[];if(r.value.trim()&&f.push(r.value.trim()),i.value.trim()&&f.push(i.value.trim()),f.length===0){o.value=[];return}const q=f.join(" ");if(d=u.search(q,{boost:{nombre:10,apellido:1},fuzzy:.2,prefix:!0,limit:l*3}),r.value.trim()&&i.value.trim()){const p=c.filter(n=>n.nombre.toLowerCase()===r.value.trim().toLowerCase()&&n.apellido.toLowerCase().includes(i.value.trim().toLowerCase())).slice(0,l),v=new Set(p.map(n=>n.id)),h=d.filter(n=>!v.has(n.id));o.value=[...p,...h].slice(0,l)}else o.value=d.slice(0,l)},P=()=>{clearTimeout(y),y=setTimeout(O,300)};return N(()=>{}),{searchId:a,searchNombre:r,searchApellido:i,results:o,loading:e,hasFilters:w,activeFilters:L,debounceSearch:P}}}).mount("#app");
